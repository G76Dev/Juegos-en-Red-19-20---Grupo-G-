<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>21 Singularity</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.20.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

//Configuración de Phaser 3
var config = {
    type: Phaser.AUTO,

    //Dimensiones de la ventana de juego (ancho y alto)
    width: 960,
    height: 540,

    //Físicas del juego
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 600 },
            debug: false
        }
    },

    //Escena principal
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

//Zona de declaración de variables
//Variable gameOver para finalizar la partida
var gameOver = false;

//Plataformas
var platforms;

//Objeto player, con la información de nuestros jugadores "player1 y player2"
function Player() {
    var cursors;
}

var player1 = new Player();
var player2 = new Player();

//Declaramos nuestro juego
var game = new Phaser.Game(config);

//Función preload, que carga elementos antes de iniciar el juego
function preload ()
{
    this.load.image('ground', 'assets/platform.png');
    this.load.spritesheet('dude', 'assets/dude.png', { frameWidth: 32, frameHeight: 48 });
}

//Función create, que crea los elementos del propio juego
function create ()
{
    //Añadimos el background
    //this.add.image(480, 270, 'bg');

    //Añadimos físicas estáticas a nuestras plataformas
    platforms = this.physics.add.staticGroup();

    //Creamos las plataformas del nivel
    platforms.create(480, 540, 'ground').setScale(2.4).refreshBody();

    //Añadimos sprite y físicas a los jugadores
    player1 = this.physics.add.sprite(100, 450, 'dude');
    player2 = this.physics.add.sprite(200, 450, 'dude');

    player1.setCollideWorldBounds(true);
    player2.setCollideWorldBounds(true);

    //Colores provisionales para distinguir los personajes
    player1.setTint(0xff0000);
    player2.setTint(0x0000ff);   

    //Inputs de los jugadores
    player1.cursors = this.input.keyboard.addKeys( { 'up': Phaser.Input.Keyboard.KeyCodes.W, 'down': Phaser.Input.Keyboard.KeyCodes.S, 'left': Phaser.Input.Keyboard.KeyCodes.A, 'right': Phaser.Input.Keyboard.KeyCodes.D } );
    player2.cursors = this.input.keyboard.createCursorKeys();

    //Creamos las animaciones de los personajes: idle, wLeft, wRight
    this.anims.create({
        key: 'wLeft',
        frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }),
        frameRate: 10,
        repeat: -1
    });

    this.anims.create({
        key: 'idle',
        frames: [ { key: 'dude', frame: 4 } ],
        frameRate: 20
    });

    this.anims.create({
        key: 'wRight',
        frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }),
        frameRate: 10,
        repeat: -1
    });

    //Añadimos las colisiones entre los jugadores y las plataformas
    this.physics.add.collider(player1, platforms);
    this.physics.add.collider(player2, platforms);
}

function update ()
{
    //Si gameOver es true, acaba la partida.
    if (gameOver)
    {
        return;
    }

    //Jugador 1
    if (player1.cursors.left.isDown)
    {
        player1.setVelocityX(-160);
        player1.anims.play('wLeft', true);
    }
    else if (player1.cursors.right.isDown)
    {
        player1.setVelocityX(160);
        player1.anims.play('wRight', true);
    }
    else
    {
        player1.setVelocityX(0);
        player1.anims.play('idle');
    }

    if (player1.cursors.up.isDown && player1.body.touching.down)
    {
        player1.setVelocityY(-330);
    }

    //Jugador 2
    if (player2.cursors.left.isDown)
    {
        player2.setVelocityX(-160);
        player2.anims.play('wLeft', true);
    }
    else if (player2.cursors.right.isDown)
    {
        player2.setVelocityX(160);
        player2.anims.play('wRight', true);
    }
    else
    {
        player2.setVelocityX(0);
        player2.anims.play('idle');
    }

    if (player2.cursors.up.isDown && player2.body.touching.down)
    {
        player2.setVelocityY(-330);
    }
}

</script>

</body>
</html>